<div class="rounded-2xl shadow-sm border p-5 hover:shadow-md transition-shadow flex flex-col h-full"
  [class]="isFavorite ? 'bg-red-50 border-red-200' : 'bg-white border-gray-100'">
  <!-- Header: Avatar + Actions -->
  <div class="flex justify-between items-start">
    <div class="w-11 h-11 rounded-xl text-white font-bold text-lg flex items-center justify-center flex-shrink-0"
      [class]="isFavorite ? 'bg-red-500' : 'bg-blue-600'">
      {{ job.company_name?.charAt(0) || job.company?.charAt(0) || '?' }}
    </div>

    <!-- Action Buttons -->
    @if (auth.isLoggedIn()) {
    <div class="flex gap-1 flex-shrink-0">
      <button (click)="toggleFavorite()"
              class="w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-100 transition-colors"
              [class.text-red-500]="isFavorite || store.isFavorite(job.slug || job.id)"
              [class.text-gray-400]="!isFavorite && !store.isFavorite(job.slug || job.id)">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4.5 h-4.5" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
        </svg>
      </button>
      <button class="w-8 h-8 rounded-full flex items-center justify-center text-gray-400 hover:bg-gray-100 hover:text-blue-600 transition-colors" title="Follow Application">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4.5 h-4.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/>
        </svg>
      </button>
    </div>
    }
  </div>

  <!-- Job Info -->
  <div class="mt-3">
    <h2 class="text-base font-bold text-gray-900 hover:text-blue-600 cursor-pointer transition-colors line-clamp-2 leading-snug">
      {{ job.title }}
    </h2>
    <p class="text-sm font-semibold text-gray-700 mt-1">{{ job.company_name || job.company }}</p>
  </div>

  <!-- Meta Info -->
  <div class="flex flex-wrap gap-x-3 gap-y-1 mt-2 text-xs text-gray-500">
    @if (job.location) {
      <span class="flex items-center gap-1">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 flex-shrink-0 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
        <span class="truncate max-w-[120px]">{{ job.location }}</span>
      </span>
    }
    @if (job.created_at || job.published_at) {
      <span class="flex items-center gap-1">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 flex-shrink-0 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        {{ job.created_at || job.published_at | date:'mediumDate' }}
      </span>
    }
    @if (job.remote) {
      <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold bg-blue-50 text-blue-600 border border-blue-200">Remote</span>
    }
  </div>

  <!-- Description -->
  <div class="text-gray-500 text-sm mt-3 overflow-hidden max-h-[3.75rem] leading-[1.25rem] [&_*]:!m-0 [&_*]:!p-0 [&_*]:!text-sm [&_*]:!text-gray-500 [&_*]:!font-normal [&_*]:!inline" [innerHTML]="job.description"></div>

  <!-- Tags -->
  @if (job.tags?.length) {
    <div class="flex flex-wrap gap-1.5 mt-3">
      @for (tag of job.tags.slice(0, 3); track tag) {
        <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-700 border border-gray-200">{{ tag }}</span>
      }
    </div>
  }

  <!-- Actions -->
  <div class="mt-auto pt-3 border-t border-gray-100">
    <a [href]="job.url" target="_blank" class="w-full inline-flex items-center justify-center gap-2 px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-bold text-sm rounded-lg transition-colors border-none">
      View Offer
      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
      </svg>
    </a>
  </div>
</div>
